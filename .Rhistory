ingredients <- str_remove_all(ingredients, "\\(\\d+\\.*\\d+\\)*") # [(0.00)]
ingredients <- str_remove_all(ingredients, "\\d+\\,*\\d*") # [0,00]
ingredients <- str_remove_all(ingredients, "\\d+\\.*\\d*") # [0.00]
ingredients[grepl("\\{", ingredients)][1:5]
ingredients <- df_subset$ingredients_text
# Transform to lower case
ingredients <- tolower(ingredients)
# We have several different cases for numbers. English vs German decimal notation
# With / without %
# Plain or surrounded by different types of brackets. Make sure to remove the brackets as well
# as later cleaning procedures could mistake them for brackets indicating intermediate product lists
# First remove %
ingredients <- str_remove_all(ingredients, "%")
# Remove decimal numbers [(0.00)] / [(0,00)] / [0.00] / [0,00]
ingredients <- str_remove_all(ingredients, "\\(\\d+\\,*\\d+\\)*") # [(0,00)]
ingredients[grepl("\\{", ingredients)][1:5]
ingredients <- df_subset$ingredients_text
# Transform to lower case
ingredients <- tolower(ingredients)
ingredients[grepl("\\{", ingredients)][1:5]
ingredients <- df_subset$ingredients_text
# Transform to lower case
ingredients <- tolower(ingredients)
# We have several different cases for numbers. English vs German decimal notation
# With / without %
# Plain or surrounded by different types of brackets. Make sure to remove the brackets as well
# as later cleaning procedures could mistake them for brackets indicating intermediate product lists
# First remove %
ingredients <- str_remove_all(ingredients, "%")
# Remove decimal numbers [(0.00)] / [(0,00)] / [0.00] / [0,00]
ingredients <- str_remove_all(ingredients, "\\(\\d+\\,*\\d*\\)*") # [(0,00)]
ingredients <- str_remove_all(ingredients, "\\(\\d+\\.*\\d*\\)*") # [(0.00)]
ingredients <- str_remove_all(ingredients, "\\d+\\,*\\d*") # [0,00]
ingredients <- str_remove_all(ingredients, "\\d+\\.*\\d*") # [0.00]
ingredients[grepl("\\{", ingredients)][1:5]
# Remove % , _, ., '
ingredients <- str_remove_all(ingredients, "%|_|\\.|\\'")
# Split by comma
ingredients <- str_split(ingredients, pattern = ",")
# Combine into single list
ingredients <- unlist(ingredients)
# Split by semicolon
ingredients <- str_split(ingredients, pattern = ";")
# Combine into single list
ingredients <- unlist(ingredients)
# The following is dangerous as "haselnÃ¼sse(3%)" would be deleted.
# Remove anything before "(" including "("
ingredients <- gsub(".*\\(","",ingredients)
# Remove ")"
ingredients <- gsub("\\)", "", ingredients)
ingredients[grepl("\\{", ingredients)][1:5]
ingredients[grepl("\\{", ingredients)][1:10]
# Remove leading dashes: - | -- | ---
ingredients <- gsub("(-*)([[:space:]a-zA-Z])", "\\2", ingredients)
# Remove leading Asterisk: * | **
ingredients <- gsub("([*]*)([[:space:]a-zA-Z])", "\\2", ingredients)
# Remove leading backslashes: / | //
ingredients <- gsub("([/]*)([[:space:]a-zA-Z])", "\\2", ingredients)
# Remove leading colons: / | //
ingredients <- gsub("([:]*)([[:space:]a-zA-Z])", "\\2", ingredients)
# Remove leading question marks: ?
ingredients <- gsub("([?]*)([[:space:]a-zA-Z])", "\\2", ingredients)
# Remove leading At Signs: @
ingredients <- gsub("([@]*)([[:space:]a-zA-Z])", "\\2", ingredients)
# Remove leading brackets:[
ingredients <- gsub("([\\[]*)([[:space:]a-zA-Z])", "\\2", ingredients)
# Remove leading vertical pipes: |
ingredients <- gsub("([\\|]*)([[:space:]a-zA-Z])", "\\2", ingredients)
# Remove leading tildes: ~
ingredients <- gsub("([~]*)([[:space:]a-zA-Z])", "\\2", ingredients)
# Remove leading, trailing spaces
ingredients <- str_trim(ingredients, side = "both")
sort(unique(ingredients))[50:100]
str.detect('[\u4e00-\u9fff]', ingredients)
str_detect('[\u4e00-\u9fff]', ingredients)
warnings()
?str_detect
str_detect(ingredients, '[\u4e00-\u9fff]')
any(str_detect(ingredients, '[\u4e00-\u9fff]'))
ingredients[str_detect(ingredients, '[\u4e00-\u9fff]')]
str_detect(ingredients,"\p{Han}")
str_detect(ingredients,"\P{Han}")
grepl("\p{IsArabic}", ingredients)
?regexpr
?stringi::stri_enc_detect()
stringi::stri_enc_detect(ingredients[1])
ingredients[1]
ingredients[1:50]
ingredients[1:500]
stringi::stri_enc_detect(ingredients)
test <- stringi::stri_enc_detect(ingredients[200:250])
test
ingredients[206]
str(ingredients)
ingredients_df <- data.frame(ingredients, stringsAsFactors = F)
ingredients_df
head(ingredients_df)
View(ingredients_df)
nrow(ingredients_df)
ingredients_df <- data.frame(sort(unique(ingredients)), stringsAsFactors = F)
nrow(ingredients_df)
stringi::stri_enc_detect(ingredients[200])
stringi::stri_enc_detect(ingredients[200])[[1]]
stringi::stri_enc_detect(ingredients[200])[[1]][1, "Encoding"]
ingredients_df %>%
mutate(encoding = stringi::stri_enc_detect(ingredients)[[1]][1, "Encoding"])
ingredients_df %>%
filter(row_number() <= 5) %>%
mutate(encoding = stringi::stri_enc_detect(ingredients)[[1]][1, "Encoding"])
ingredients_df <- data.frame(ingredients = sort(unique(ingredients)), stringsAsFactors = F)
head(ingredients_df)
ingredients_df %>% filter(row_number() < 6) %>%
mutate(enc = stringi::stri_enc_detect(ingredients)[[1]][1, "Encoding"])
ingredients_df %>% filter(row_number() < 500) %>%
mutate(enc = stringi::stri_enc_detect(ingredients)[[1]][1, "Encoding"])
ingredients_df <-
ingredients_df %>%
mutate(enc = stringi::stri_enc_detect(ingredients)[[1]][1, "Encoding"])
unique(ingredients_df$enc)
stringi::stri_enc_detect(ingredients_df$ingredients[5])
stringi::stri_enc_detect(ingredients_df$ingredients[1:5])
stringi::stri_enc_detect(ingredients_df$ingredients[55:100])
55 + 31
ingredients_df$ingredients[86]
stringi::stri_enc_detect(ingredients_df$ingredients[5000])
ingredients_df$ingredients[5000]
ingredients_enc <- stringi::stri_enc_detect(ingredients_df$ingredients)
?bind_rows()
test_df <- bind_rows(ingredients_enc, .id = ingredients_df$ingredients)
test_df <- bind_rows(ingredients_enc, .id = 1:nrow(ingredients_df))
ingredients_enc[[1]]
ingredients_enc[[2]]
class(ingredients_enc[[2]])
test_df <- bind_rows(ingredients_enc, .id = "id")
head(test_df)
enc_df <- bind_rows(ingredients_enc, .id = "id")
enc_df %>% pivot_wider(id_cols = id, names_from = Encoding, values_from = Confidence)
enc_df %>% select(-Language) %>% pivot_wider(id_cols = id, names_from = Encoding, values_from = Confidence)
enc_df %>%
group_by(id, Encoding) %>%
summarise_at(vars(Confidence), sum, na.rm = T) %>%
pivot_wider(id_cols = id, names_from = Encoding, values_from = Confidence)
enc_df <-
enc_df %>%
group_by(id, Encoding) %>%
summarise_at(vars(Confidence), sum, na.rm = T) %>%
pivot_wider(id_cols = id, names_from = Encoding, values_from = Confidence)
ingredients_df <- data.frame(ingredients = sort(unique(ingredients)), id = 1:length(ingredients) stringsAsFactors = F)
ingredients_df <- data.frame(ingredients = sort(unique(ingredients)), id = 1:length(ingredients), stringsAsFactors = F)
ingredients_df <- data.frame(ingredients = sort(unique(ingredients)), stringsAsFactors = F)
ingredients_df["id"] <- 1:nrow(ingredients_df)
ingredients_enc <- stringi::stri_enc_detect(ingredients_df$ingredients)
head(enc_df)
enc_df <- bind_rows(ingredients_enc, .id = "id")
enc_df <-
enc_df %>%
group_by(id, Encoding) %>%
summarise_at(vars(Confidence), sum, na.rm = T) %>%
pivot_wider(id_cols = id, names_from = Encoding, values_from = Confidence) %>%
mutate(id = as.numeric(id))
head(enc_df)
ingredients_df %>%
left_join(enc_df, by = "id") %>% head()
ingredients_df <-
ingredients_df %>%
left_join(enc_df, by = "id")
library(ggplot2)
ingredients_df %>%
pivot_longer(cols = -c(ingredients, id))
ingredients_df %>%
pivot_longer(cols = -c(ingredients, id)) %>%
ggplot(aes(x = name, y = value)) +
geom_violin()
ingredients_df %>%
pivot_longer(cols = -c(ingredients, id)) %>%
ggplot(aes(x = name, y = value)) +
geom_violin() +
coord_flip()
ingredients_df %>%
pivot_longer(cols = -c(ingredients, id)) %>%
ggplot(aes(x = name, y = value)) +
geom_swarm() +
coord_flip()
ingredients_df %>%
pivot_longer(cols = -c(ingredients, id)) %>%
ggplot(aes(x = name, y = value)) +
geom_boxplot() +
coord_flip()
filter(ingredients_df, `windows-1252` > 0.5)
filter(ingredients_df, `windows-1252` > 0.8)
filter(ingredients_df, `windows-1252` > 0.9)
filter(ingredients_df, `windows-1253` > 0.9)
filter(ingredients_df, `windows-1253` > 0.6)
filter(ingredients_df, `windows-1253` > 0.5)
filter(ingredients_df, `KOI8-R` > 0.5)
filter(ingredients_df, `KOI8-R` > 0.3)
head(enc_df)
head(ingredients_df)
ingredients_df %>%
pivot_longer(cols = -c(ingredients, id)) %>% head()
ingredients_df %>%
pivot_longer(cols = -c(ingredients, id)) %>%
filter(is.na(value), value > 0.6)
ingredients_df %>%
pivot_longer(cols = -c(ingredients, id)) %>%
filter(!is.na(value), value > 0.6)
ingredients_df %>%
pivot_longer(cols = -c(ingredients, id)) %>%
filter(!is.na(value), value > 0.6) %>%
count(name)
ingredients_df %>%
pivot_longer(cols = -c(ingredients, id)) %>%
filter(!is.na(value), value > 0.6) %>%
count(name) %>% arrange(desc(n))
ingredients_df %>%
pivot_longer(cols = -c(ingredients, id)) %>%
filter(!is.na(value), value > 0.5) %>%
count(name) %>% arrange(desc(n))
c(
"UTF-8",	"--",
"UTF-16BE",	"--",
"UTF-16LE",	"--",
"UTF-32BE",	"--",
"UTF-32LE",	"--",
"Shift_JIS",	"Japanese",
"ISO-2022-JP",	"Japanese",
"ISO-2022-CN",	"Simplified Chinese",
"ISO-2022-KR",	"Korean",
"GB18030",	"Chinese",
"Big5",	"Traditional Chinese",
"EUC-JP",	"Japanese",
"EUC-KR",	"Korean",
"ISO-8859-1",	"Danish, Dutch, English, French, German, Italian, Norwegian, Portuguese, Swedish",
"ISO-8859-2",	"Czech, Hungarian, Polish, Romanian",
"ISO-8859-5",	"Russian",
"ISO-8859-6",	"Arabic",
"ISO-8859-7",	"Greek",
"ISO-8859-8",	"Hebrew",
"ISO-8859-9",	"Turkish",
"windows-1250",	"Czech, Hungarian, Polish, Romanian",
"windows-1251",	"Russian",
"windows-1252",	"Danish, Dutch, English, French, German, Italian, Norwegian, Portuguese, Swedish",
"windows-1253",	"Greek",
"windows-1254",	"Turkish",
"windows-1255",	"Hebrew",
"windows-1256",	"Arabic",
"KOI8-R",	"Russian",
"IBM420",	"Arabic",
"IBM424",	"Hebrew"
)
matrix(
c(
"UTF-8",	"--",
"UTF-16BE",	"--",
"UTF-16LE",	"--",
"UTF-32BE",	"--",
"UTF-32LE",	"--",
"Shift_JIS",	"Japanese",
"ISO-2022-JP",	"Japanese",
"ISO-2022-CN",	"Simplified Chinese",
"ISO-2022-KR",	"Korean",
"GB18030",	"Chinese",
"Big5",	"Traditional Chinese",
"EUC-JP",	"Japanese",
"EUC-KR",	"Korean",
"ISO-8859-1",	"Danish, Dutch, English, French, German, Italian, Norwegian, Portuguese, Swedish",
"ISO-8859-2",	"Czech, Hungarian, Polish, Romanian",
"ISO-8859-5",	"Russian",
"ISO-8859-6",	"Arabic",
"ISO-8859-7",	"Greek",
"ISO-8859-8",	"Hebrew",
"ISO-8859-9",	"Turkish",
"windows-1250",	"Czech, Hungarian, Polish, Romanian",
"windows-1251",	"Russian",
"windows-1252",	"Danish, Dutch, English, French, German, Italian, Norwegian, Portuguese, Swedish",
"windows-1253",	"Greek",
"windows-1254",	"Turkish",
"windows-1255",	"Hebrew",
"windows-1256",	"Arabic",
"KOI8-R",	"Russian",
"IBM420",	"Arabic",
"IBM424",	"Hebrew"
), byrow = T, ncol = 2)
enc_map <-
as.data.frame(
matrix(
c(
"UTF-8",	"--",
"UTF-16BE",	"--",
"UTF-16LE",	"--",
"UTF-32BE",	"--",
"UTF-32LE",	"--",
"Shift_JIS",	"Japanese",
"ISO-2022-JP",	"Japanese",
"ISO-2022-CN",	"Simplified Chinese",
"ISO-2022-KR",	"Korean",
"GB18030",	"Chinese",
"Big5",	"Traditional Chinese",
"EUC-JP",	"Japanese",
"EUC-KR",	"Korean",
"ISO-8859-1",	"Danish, Dutch, English, French, German, Italian, Norwegian, Portuguese, Swedish",
"ISO-8859-2",	"Czech, Hungarian, Polish, Romanian",
"ISO-8859-5",	"Russian",
"ISO-8859-6",	"Arabic",
"ISO-8859-7",	"Greek",
"ISO-8859-8",	"Hebrew",
"ISO-8859-9",	"Turkish",
"windows-1250",	"Czech, Hungarian, Polish, Romanian",
"windows-1251",	"Russian",
"windows-1252",	"Danish, Dutch, English, French, German, Italian, Norwegian, Portuguese, Swedish",
"windows-1253",	"Greek",
"windows-1254",	"Turkish",
"windows-1255",	"Hebrew",
"windows-1256",	"Arabic",
"KOI8-R",	"Russian",
"IBM420",	"Arabic",
"IBM424",	"Hebrew"
), byrow = T, ncol = 2), stringsAsFactors = F)
names(enc_map) <- c("Character_Set", "Languages")
ingredients_df %>%
pivot_longer(cols = -c(ingredients, id)) %>%
filter(!is.na(value), value > 0.5) %>%
count(name) %>% arrange(desc(n))
ingredients_df %>%
pivot_longer(cols = -c(ingredients, id)) %>%
filter(!is.na(value), value > 0.5) %>%
count(name) %>% arrange(desc(n)) %>%
left_join(enc_map, by = c("name" = "Character_Set"))
filter(ingredients_df, `ISO-8859-9` > 0.7)
filter(ingredients_df, `ISO-8859-9` > 0.9)
filter(ingredients_df, `ISO-8859-9` > 0.9) %>% View()
count(ingredients)
count(data.frame(ingredients))
data.frame(ingredients)
data.frame(ingredients) %>% count(ingredients)
data.frame(ingredients) %>% count(ingredients) %>% filter(n > 50) %>% arrange(desc(n))
data.frame(ingredients) %>% count(ingredients) %>% filter(n > 200) %>% arrange(desc(n))
data.frame(ingredients) %>% count(ingredients) %>% filter(n > 500) %>% arrange(desc(n))
data.frame(ingredients) %>% count(ingredients) %>% filter(n > 1750) %>% arrange(desc(n))
data.frame(ingredients) %>% filter(ingredients != "") %>% count(ingredients) %>% filter(n > 1750) %>% arrange(desc(n))
data.frame(ingredients) %>% filter(ingredients != "") %>% count(ingredients) %>% filter(n == 1) %>% arrange(desc(n))
ingredients_unique <- sort(unique(ingredients))
ingredients_df <- data.frame(ingredients = ingredients_unique, stringsAsFactors = F)
ingredients_df["id"] <- 1:nrow(ingredients_df)
ingredients_enc <- stringi::stri_enc_detect(ingredients_unique)
enc_df <- bind_rows(ingredients_enc, .id = "id")
enc_df <-
enc_df %>%
group_by(id, Encoding) %>%
summarise_at(vars(Confidence), sum, na.rm = T) %>%
pivot_wider(id_cols = id, names_from = Encoding, values_from = Confidence) %>%
mutate(id = as.numeric(id))
ingredients_df <-
ingredients_df %>%
left_join(enc_df, by = "id")
ingredients_df %>%
pivot_longer(cols = -c(ingredients, id)) %>%
filter(!is.na(value), value > 0.5) %>%
count(name) %>% arrange(desc(n))
ingredients_df %>%
pivot_longer(cols = -c(ingredients, id)) %>%
filter(!is.na(value), value > 0.5) %>%
count(name) %>% arrange(desc(n)) %>%
left_join(enc_map, by = c("name" = "Character_Set"))
ingredients_enc[1:5]
ingredients_unique[1:10]
View(ingredients_unique)
str(ingredients_unique)
str(ingredients_unique[1:500])
ingredients_unique[1:500]
ingredients_unique[5000]
ingredients_unique[50000]
ingredients_unique[50001]
ingredients_unique[57188]
ingredients_unique[57187]
ingredients_unique[1]
ingredients_unique[2]
ingredients_unique[50]
ingredients_unique[100]
enc_df[100]
enc_df[,100]
ingredients_enc[100]
filter(ingredients_df, `IBM420_ltr` > 0.3)
filter(ingredients_df, `IBM420_ltr` > 0.5)
ingredients_enc[100]
ingredients_unique[100:120]
ingredients_unique[100:125]
ingredients_unique[100:130]
ingredients_unique[90:130]
ingredients_unique[100:130]
ingredients_unique[100:150]
ingredients_unique[100:150] %>% View()
ingredients_unique[100:140] %>% View()
ingredients_unique[100:140]
ingredients_enc[140]
grep("[\\p{Han}]", ingredients_unique, value = T, perl = T)
grep("[\\p{Han}]", ingredients_unique, value = F, perl = T)
length(grep("[\\p{Han}]", ingredients_unique, value = F, perl = T))
length(grep("[\\p{Cyrillic}]", ingredients_unique, value = F, perl = T))
grep("[\\p{Arabic}]", ingredients_unique, value = T, perl = T)
p_list <-
c(
"Common",
"Arabic",
"Armenian",
"Bengali",
"Bopomofo",
"Braille",
"Buhid",
"Canadian_Aboriginal",
"Cherokee",
"Cyrillic",
"Devanagari",
"Ethiopic",
"Georgian",
"Greek",
"Gujarati",
"Gurmukhi",
"Han",
"Hangul",
"Hanunoo",
"Hebrew",
"Hiragana",
"Inherited",
"Kannada",
"Katakana",
"Khmer",
"Lao",
"Latin",
"Limbu",
"Malayalam",
"Mongolian",
"Myanmar",
"Ogham",
"Oriya",
"Runic",
"Sinhala",
"Syriac",
"Tagalog",
"Tagbanwa",
"TaiLe",
"Tamil",
"Telugu",
"Thaana",
"Thai",
"Tibetan",
"Yi")
p_list
p_list_n <-
lapply(p_list, function(x){
length(grep(paste0("[\\p{", x, "}]"), ingredients_unique, value = F, perl = T))
})
p_list <-
c(
"Common",
"Arabic",
"Armenian",
"Bengali",
"Bopomofo",
"Braille",
"Buhid",
"Canadian_Aboriginal",
"Cherokee",
"Cyrillic",
"Devanagari",
"Ethiopic",
"Georgian",
"Greek",
"Gujarati",
"Gurmukhi",
"Han",
"Hangul",
"Hanunoo",
"Hebrew",
"Hiragana",
"Inherited",
"Kannada",
"Katakana",
"Khmer",
"Lao",
"Latin",
"Limbu",
"Malayalam",
"Mongolian",
"Myanmar",
"Ogham",
"Oriya",
"Runic",
"Sinhala",
"Syriac",
"Tagalog",
"Tagbanwa",
"Tamil",
"Telugu",
"Thaana",
"Thai",
"Tibetan",
"Yi")
p_list_n <-
lapply(p_list, function(x){
length(grep(paste0("[\\p{", x, "}]"), ingredients_unique, value = F, perl = T))
})
p_df <-
data.frame("P_Type" = p_list, "N" = p_list_n)
head(p_df)
p_df <-
data.frame("P_Type" = p_list, "N" = unlist(p_list_n))
p_df
p_df %>% filter(N != 0) %>% arrange(desc(N))
source('C:/Users/Philipp/Desktop/Github/Covid_Map/createPlot.R')
source('C:/Users/Philipp/Desktop/Github/Covid_Map/createPlot.R')
rm(list=ls())
